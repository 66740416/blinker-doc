# 设备上线与通信  
本文档适用于使用点灯自有Broker  
## 设备上线

### 获取连接信息

**接口**  

``` 
GET https://iot.diandeng.tech/api/v1/user/device/diy/auth?authKey={authKey}
```

**Response**  

``` js
{
    message: 1000
    detail: {
        broker: 'blinker',
        deviceName: 'BDB1C0D8PS3Rxxxxxxxxxxxx',
        iotId: 'xxxxxxxxJLSBnI13000000',
        iotToken: 'xxxxxxxxxx468856^4f15936243c64fd',
        uuid: '9140d0b9843b40d6bc439exxxxxxxxxx'
    }
}
```

## 通信  

### 连接
使用以上连接信息，即可连接MQTT Broker  

``` js
mqtt.connect('mqtts://hub.diandeng.tech', {
    clientId: deviceName,
    username: iotId,
    password: iotToken
});
```

### 发布  

``` 
TOPIC /{deviceName}/s
```

``` json
{"toDevice":"xxxxxxxx","data":"abcdefg"}
```

### 订阅  

``` 
TOPIC /{deviceName}/r
```

``` json
{"fromDevice":"xxxxxxxx","data":"abcdefg"}
```
